



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Utilizing Cisco CXTA service framework to validate network elements">
      
      
      
        <meta name="author" content="Ava Thorn, Oliver Boehmer">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>02 Parsing Text - DEVWKS-1407</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#command-output-parsing-exercises" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="DEVWKS-1407" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              DEVWKS-1407
            </span>
            <span class="md-header-nav__topic">
              02 Parsing Text
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/oboehmer/CLEUR20-CXTA/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="DEVWKS-1407" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    DEVWKS-1407
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/oboehmer/CLEUR20-CXTA/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../00-setup/" title="00 Setup" class="md-nav__link">
      00 Setup
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../01-basic/" title="01 Basic Tests" class="md-nav__link">
      01 Basic Tests
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        02 Parsing Text
      </label>
    
    <a href="./" title="02 Parsing Text" class="md-nav__link md-nav__link--active">
      02 Parsing Text
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#simple-parsing" title="Simple Parsing" class="md-nav__link">
    Simple Parsing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bonus-exercise-leveraging-parameterization" title="Bonus Exercise: Leveraging Parameterization" class="md-nav__link">
    Bonus Exercise: Leveraging Parameterization
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#more-complex-parsing" title="More Complex Parsing" class="md-nav__link">
    More Complex Parsing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parsing-using-textfsm" title="Parsing using TextFSM" class="md-nav__link">
    Parsing using TextFSM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-and-retrying" title="Configuring and Retrying" class="md-nav__link">
    Configuring and Retrying
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" title="Next Steps" class="md-nav__link">
    Next Steps
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../03-genie/" title="03 pyATS Genie" class="md-nav__link">
      03 pyATS Genie
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../docs/" title="CXTA Documentation" class="md-nav__link">
      CXTA Documentation
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#simple-parsing" title="Simple Parsing" class="md-nav__link">
    Simple Parsing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bonus-exercise-leveraging-parameterization" title="Bonus Exercise: Leveraging Parameterization" class="md-nav__link">
    Bonus Exercise: Leveraging Parameterization
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#more-complex-parsing" title="More Complex Parsing" class="md-nav__link">
    More Complex Parsing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parsing-using-textfsm" title="Parsing using TextFSM" class="md-nav__link">
    Parsing using TextFSM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-and-retrying" title="Configuring and Retrying" class="md-nav__link">
    Configuring and Retrying
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" title="Next Steps" class="md-nav__link">
    Next Steps
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/oboehmer/CLEUR20-CXTA/edit/master/docs/02-parsing.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="command-output-parsing-exercises">Command Output Parsing Exercises</h1>
<p>Despite the enhancements to deal with network devices in a programmatic way over APIs (i.e. REST, NETCONF, etc.), parsing command line output remains to be a major task when dealing with diverse network environments.</p>
<p>CXTA provides a variety of keywords and approaches to deal with parsing, which we want to introduce in this exercise.</p>
<p>We again leverage the device environment shown earlier, and demonstrate multiple approaches on how to parse text data.</p>
<h2 id="simple-parsing">Simple Parsing</h2>
<p>In this test suite we show how to use simple approaches like checking for texts appearing, or extracting values from tests using Regular Expressions, a common way to parse text output.</p>
<p>The command output we'll parse is the same for all the test cases in the first suite: <code>show ip ospf neighbor</code> which displays the OSPF neighbour status on one of the two routers (r1 in this case):</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nv">r1</span>#<span class="k">show</span> <span class="nv">ip</span> <span class="nv">ospf</span> <span class="nv">neighbor</span>

<span class="nv">Neighbor</span> <span class="nv">ID</span>     <span class="nv">Pri</span>   <span class="nv">State</span>           <span class="nv">Dead</span> <span class="nv">Time</span>   <span class="nv">Address</span>         <span class="nv">Interface</span>
<span class="mi">10</span>.<span class="mi">0</span>.<span class="mi">0</span>.<span class="mi">2</span>          <span class="mi">1</span>   <span class="nv">FULL</span><span class="o">/</span><span class="nv">DR</span>         <span class="mi">00</span>:<span class="mi">00</span>:<span class="mi">31</span>    <span class="mi">172</span>.<span class="mi">16</span>.<span class="mi">0</span>.<span class="mi">2</span>      <span class="nv">GigabitEthernet2</span>
</pre></div>
</td></tr></table>

<p>you can connect to the device (using <code>vagrant ssh r1</code> from outside the container) to check yourself. </p>
<p>Please change to the 02-parsing directory (<code>cd ../02-parsing</code>, assuming you are still in the 01-basic directory from the previous test) and examine the file <code>02-simple.robot</code> (also shown below).</p>
<p>A few notes here:</p>
<ul>
<li>CXTA has evolved over time and has aggregated keywords from different sources within Cisco and externally over the years, and so some redundancy has been accumulated where the same task can be achieved using different keywords. For example the <code>run "show ip ospf neighbor"</code>  keyword on a device which has previously been selected is pretty much equivalent with the <code>execute command ..</code> keyword seen in the previous chapter.</li>
<li>As robot interprets the backslash (<code>\</code>), we need to escape the backslashes used in Regular expressions (hence the <code>\\</code> seen in the expressions below)</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59</pre></div></td><td class="code"><div class="codehilite"><pre><span></span># <span class="nv">cd</span> ..<span class="o">/</span><span class="mi">02</span><span class="o">-</span><span class="nv">parsing</span><span class="o">/</span>
# <span class="nv">cat</span> <span class="mi">02</span><span class="o">-</span><span class="nv">simple</span>.<span class="nv">robot</span>

<span class="o">***</span> <span class="nv">Settings</span> <span class="o">***</span>
<span class="nv">Library</span>       <span class="nv">CXTA</span>
<span class="nv">Resource</span>      <span class="nv">cxta</span>.<span class="nv">robot</span>
<span class="nv">Library</span>       <span class="nv">Collections</span>       # <span class="nv">Imports</span> <span class="nv">a</span> <span class="nv">public</span> <span class="nv">Robot</span> <span class="nv">framework</span> <span class="nv">library</span> <span class="nv">which</span> <span class="nv">provides</span> <span class="nv">the</span> <span class="nv">keyword</span> <span class="s2">&quot;</span><span class="s">Log List</span><span class="s2">&quot;</span> <span class="nv">used</span> <span class="nv">in</span> <span class="nv">one</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">tests</span>
<span class="nv">Suite</span> <span class="nv">Setup</span>   <span class="nv">Load</span> <span class="nv">testbed</span> <span class="nv">and</span> <span class="k">connect</span> <span class="nv">to</span> <span class="nv">devices</span>

<span class="o">***</span> <span class="nv">Variables</span> <span class="o">***</span>
${<span class="nv">testbed</span>}     ${<span class="nv">CURDIR</span>}<span class="o">/</span>..<span class="o">/</span><span class="nv">testbed</span>.<span class="nv">yaml</span>
${<span class="nv">device</span>}      <span class="nv">r1</span>           # <span class="nv">Device</span> <span class="nv">under</span> <span class="nv">test</span>
${<span class="nv">nbr_id</span>}      <span class="mi">10</span>.<span class="mi">0</span>.<span class="mi">0</span>.<span class="mi">2</span>     # <span class="nv">excpected</span> <span class="nv">neighbour</span> <span class="nv">router</span> <span class="nv">id</span>

<span class="o">***</span> <span class="nv">Test</span> <span class="nv">Cases</span> <span class="o">***</span>
<span class="nv">Check</span> <span class="nv">OSPF</span> <span class="nv">neighbour</span> <span class="nv">state</span> <span class="o">-</span> <span class="nv">basic</span> <span class="nv">output</span> <span class="nv">match</span>
    # <span class="nv">using</span> <span class="nv">CXTA</span> <span class="nv">keywords</span> <span class="nv">which</span> <span class="nv">are</span> <span class="nv">a</span> <span class="nv">bit</span> <span class="nv">shorter</span> <span class="nv">than</span> <span class="nv">the</span> <span class="nv">ones</span> <span class="nv">we</span><span class="s1">&#39;</span><span class="s">ve seen</span>
    <span class="nv">select</span> <span class="nv">device</span> <span class="s2">&quot;</span><span class="s">${device}</span><span class="s2">&quot;</span>
    <span class="nv">run</span> <span class="s2">&quot;</span><span class="s">show ip ospf neighbor</span><span class="s2">&quot;</span>
    <span class="nv">output</span> <span class="nv">contains</span> <span class="s2">&quot;</span><span class="s">FULL</span><span class="s2">&quot;</span>

<span class="nv">Check</span> <span class="nv">OSPF</span> <span class="nv">neighbour</span> <span class="nv">ID</span> <span class="nv">using</span> <span class="nv">regexp</span> <span class="nv">parsing</span>
    <span class="nv">select</span> <span class="nv">device</span> <span class="s2">&quot;</span><span class="s">${device}</span><span class="s2">&quot;</span>
    <span class="nv">run</span> <span class="s2">&quot;</span><span class="s">show ip ospf neighbor</span><span class="s2">&quot;</span>
    # <span class="nv">uses</span> <span class="nv">a</span> <span class="nv">cxta</span> <span class="nv">keyword</span> <span class="nv">to</span> <span class="nv">find</span> <span class="nv">all</span> <span class="nv">regex</span> <span class="nv">pattern</span> <span class="nv">matches</span> <span class="nv">on</span> <span class="nv">the</span> <span class="nv">output</span> <span class="nv">from</span> <span class="nv">the</span> <span class="k">show</span> <span class="nv">command</span> <span class="nv">above</span>
    # <span class="nv">the</span> <span class="nv">pattern</span> <span class="nv">will</span> <span class="nv">match</span> <span class="nv">IPv4</span> <span class="nv">address</span>, <span class="nv">e</span>.<span class="nv">g</span>. <span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">10</span>. <span class="nv">All</span> <span class="nv">pattern</span> <span class="nv">matches</span> <span class="nv">will</span> <span class="nv">be</span> <span class="nv">saved</span> <span class="nv">in</span> <span class="nv">a</span> <span class="nv">list</span>.
    # <span class="nv">regex</span> <span class="nv">backslashes</span> <span class="nv">need</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">escaped</span> <span class="nv">as</span> <span class="nv">Robot</span> <span class="nv">interprets</span> <span class="nv">them</span> <span class="nv">as</span> <span class="nv">well</span>
    ${<span class="nv">output</span>}<span class="o">=</span>  <span class="nv">extract</span> <span class="nv">patterns</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s">d+</span><span class="se">\\</span><span class="s">.</span><span class="se">\\</span><span class="s">d+</span><span class="se">\\</span><span class="s">.</span><span class="se">\\</span><span class="s">d+</span><span class="se">\\</span><span class="s">.</span><span class="se">\\</span><span class="s">d+</span><span class="s2">&quot;</span>

    # <span class="nv">uses</span> <span class="nv">a</span> <span class="nv">couple</span> <span class="nv">of</span> <span class="nv">keywords</span> <span class="nv">to</span> <span class="nv">log</span> <span class="nv">the</span> <span class="nb">result</span> <span class="nv">of</span> <span class="nv">the</span> <span class="s1">&#39;</span><span class="s">extract patterns</span><span class="s1">&#39;</span> <span class="nv">keyword</span> <span class="o">-</span> <span class="nv">view</span> <span class="nv">these</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">log</span>.<span class="nv">html</span>
    <span class="nv">log</span>  ${<span class="nv">output</span>}
    <span class="nv">log</span> <span class="nv">list</span>  ${<span class="nv">output</span>}

    # <span class="nv">check</span> <span class="k">if</span> <span class="nv">the</span> <span class="nv">first</span> <span class="nv">element</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">list</span> <span class="nv">is</span> <span class="nv">what</span> <span class="nv">we</span> <span class="nv">expect</span>
    <span class="nv">Should</span> <span class="nv">be</span> <span class="nv">Equal</span> <span class="nv">as</span> <span class="nv">Strings</span>   ${<span class="nv">output</span>}[<span class="mi">0</span>]   ${<span class="nv">nbr_id</span>}

<span class="nv">Check</span> <span class="nv">OSPF</span> <span class="nv">neighbour</span> <span class="nv">state</span> <span class="nv">using</span> <span class="nv">regexp</span> <span class="nv">parsing</span><span class="o">-</span><span class="mi">1</span>
    # <span class="k">if</span> <span class="nv">the</span> <span class="nv">whole</span> <span class="nv">test</span> <span class="nv">suite</span> <span class="nv">was</span> <span class="nv">executed</span>, <span class="nv">these</span> <span class="nv">keywords</span> <span class="nv">would</span> <span class="nv">not</span> <span class="nv">be</span> <span class="nv">needed</span> <span class="nv">as</span> <span class="nv">the</span> <span class="nv">output</span>
    # <span class="nv">would</span> <span class="nv">still</span> <span class="nv">be</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">buffer</span> <span class="nv">from</span> <span class="nv">the</span> <span class="nv">previous</span> <span class="nv">test</span> <span class="nv">case</span>
    <span class="nv">select</span> <span class="nv">device</span> <span class="s2">&quot;</span><span class="s">${device}</span><span class="s2">&quot;</span>
    <span class="nv">run</span> <span class="s2">&quot;</span><span class="s">show ip ospf neighbor</span><span class="s2">&quot;</span>

    # <span class="nv">uses</span> <span class="nv">a</span> <span class="nv">longer</span> <span class="nv">regex</span> <span class="nv">pattern</span> <span class="nv">to</span> <span class="nv">retrieve</span> <span class="nv">the</span> <span class="nv">ospf</span> <span class="nv">state</span>, <span class="nv">here</span> <span class="nv">using</span> <span class="nv">anchoring</span> <span class="nv">to</span> <span class="nv">fetch</span>
    # <span class="nv">only</span> <span class="nv">the</span> <span class="nv">state</span>,  <span class="ss">(</span>[\\<span class="nv">w</span>]<span class="o">+</span><span class="ss">)</span>
    ${<span class="nv">output</span>}<span class="o">=</span>  <span class="nv">extract</span> <span class="nv">pattern</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s">d+</span><span class="se">\\</span><span class="s">.</span><span class="se">\\</span><span class="s">d+</span><span class="se">\\</span><span class="s">.</span><span class="se">\\</span><span class="s">d+</span><span class="se">\\</span><span class="s">.</span><span class="se">\\</span><span class="s">d+</span><span class="se">\\</span><span class="s">s+</span><span class="se">\\</span><span class="s">d+</span><span class="se">\\</span><span class="s">s+([</span><span class="se">\\</span><span class="s">w]+)</span><span class="s2">&quot;</span>
    <span class="nv">Should</span> <span class="nv">be</span> <span class="nv">equal</span>  ${<span class="nv">output</span>}   <span class="nv">FULL</span>

<span class="nv">Check</span> <span class="nv">OSPF</span> <span class="nv">neighbour</span> <span class="nv">state</span> <span class="nv">using</span> <span class="nv">regexp</span> <span class="nv">parsing</span><span class="o">-</span><span class="mi">2</span>
    <span class="nv">select</span> <span class="nv">device</span> <span class="s2">&quot;</span><span class="s">${device}</span><span class="s2">&quot;</span>
    <span class="nv">run</span> <span class="s2">&quot;</span><span class="s">show ip ospf neighbor</span><span class="s2">&quot;</span>
    # <span class="nv">instead</span> <span class="nv">of</span> <span class="nv">extracting</span> <span class="nv">patterns</span>, <span class="nv">we</span> <span class="nv">can</span> <span class="nv">verify</span> <span class="nv">that</span> <span class="nv">the</span> <span class="nv">output</span> <span class="nv">matches</span> <span class="nv">a</span> <span class="nv">pattern</span>
    # <span class="nv">in</span> <span class="nv">this</span> <span class="nv">example</span> <span class="nv">we</span> <span class="nv">are</span> <span class="nv">checking</span> <span class="nv">that</span> <span class="s1">&#39;</span><span class="s">FULL/</span><span class="s1">&#39;</span> <span class="nv">is</span> <span class="nv">the</span> <span class="nv">state</span>
    <span class="nv">output</span> <span class="nv">matches</span> <span class="nv">pattern</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s">d+</span><span class="se">\\</span><span class="s">.</span><span class="se">\\</span><span class="s">d+</span><span class="se">\\</span><span class="s">.</span><span class="se">\\</span><span class="s">d+</span><span class="se">\\</span><span class="s">.</span><span class="se">\\</span><span class="s">d+</span><span class="se">\\</span><span class="s">s+</span><span class="se">\\</span><span class="s">d+</span><span class="se">\\</span><span class="s">s+FULL\/.*</span><span class="s2">&quot;</span>
    <span class="nv">output</span> <span class="nv">matches</span> <span class="nv">pattern</span> <span class="s2">&quot;</span><span class="s">.*FULL\/.*</span><span class="s2">&quot;</span>

<span class="o">***</span> <span class="nv">Keywords</span> <span class="o">***</span>
<span class="nv">Load</span> <span class="nv">testbed</span> <span class="nv">and</span> <span class="k">connect</span> <span class="nv">to</span> <span class="nv">devices</span>
    <span class="nv">use</span> <span class="nv">testbed</span> <span class="s2">&quot;</span><span class="s">${testbed}</span><span class="s2">&quot;</span>
    <span class="k">connect</span> <span class="nv">to</span> <span class="nv">device</span> <span class="s2">&quot;</span><span class="s">${device}</span><span class="s2">&quot;</span>
</pre></div>
</td></tr></table>

<p>Run this test (from within the container) and examine the <a href="../logs/log-02-simple.html" target="_blank">log.html</a> created.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">root</span><span class="mi">@14</span><span class="nl">b56b5cc0ac</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">devnet</span><span class="o">/</span><span class="n">cxta</span><span class="o">/</span><span class="mo">02</span><span class="o">-</span><span class="n">parsing</span><span class="err">#</span> <span class="n">robot</span> <span class="mo">02</span><span class="o">-</span><span class="n">simple</span><span class="p">.</span><span class="n">robot</span>
</pre></div>
</td></tr></table>

<h3 id="bonus-exercise-leveraging-parameterization">Bonus Exercise: Leveraging Parameterization</h3>
<p>You might have noticed that we have parameterized the router name and expected router ID in the above test cases using variables. This enables us to easily adapt the test to a different environment: We can easily re-run the test on the other router (r2) and thus check for a different neighbor IP address (10.0.0.1) by overwriting the defined variables values on the command line using the <code>-v VAR:VALUE</code> command line options. Please give it a go:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="o">#</span> <span class="n">robot</span> <span class="o">-</span><span class="n">v</span> <span class="n">device</span><span class="p">:</span><span class="n">r2</span> <span class="o">-</span><span class="n">v</span> <span class="n">nbr_id</span><span class="p">:</span><span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span> <span class="mi">02</span><span class="o">-</span><span class="k">simple</span><span class="p">.</span><span class="n">robot</span>
</pre></div>
</td></tr></table>

<h2 id="more-complex-parsing">More Complex Parsing</h2>
<p>Parsing text using regular expression can be cumbersome, especially if the use case requires parsing multiple values from a single command output, potentially spread across different line.</p>
<p>CXTA offers two approaches: TextFSM (shown below), and pyATS Genie (next chapter)</p>
<h3 id="parsing-using-textfsm">Parsing using TextFSM</h3>
<p><a href="https://github.com/google/textfsm/wiki/TextFSM">TextFSM</a> is a Python module that implements a template based state machine for parsing semi-formatted text. Originally developed to allow programmatic access to information given by the output of CLI driven devices, such as network routers and switches, it can however be used for any such textual output.  </p>
<p>CXTA has close to 1000 TextFSM templates which are able to parse a large variety of command from Cisco and 3rd party network devices, and the test user can also supply his/her own.</p>
<p>In one of the tests defined in <em>02-complex.robot</em>, we use a custom TextFSM file just for demo purposes, you can find it as <em>show_ip_ospf_neighbor.textfsm</em> in the current directory:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Value NEIGHBOR_ID (\d+.\d+.\d+.\d+)
Value PRIORITY (\d+)
Value STATE (\S+\/\s+\-|\S+)
Value DEAD_TIME (\d+:\d+:\d+)
Value ADDRESS (\d+.\d+.\d+.\d+)
Value INTERFACE (\S+)

Start
  ^<span class="cp">${</span><span class="n">NEIGHBOR_ID</span><span class="cp">}</span>\s+<span class="cp">${</span><span class="n">PRIORITY</span><span class="cp">}</span>\s+<span class="cp">${</span><span class="n">STATE</span><span class="cp">}</span>\s+<span class="cp">${</span><span class="n">DEAD_TIME</span><span class="cp">}</span>\s+<span class="cp">${</span><span class="n">ADDRESS</span><span class="cp">}</span>\s+<span class="cp">${</span><span class="n">INTERFACE</span><span class="cp">}</span> -&gt; Record
</pre></div>
</td></tr></table>

<p>This template extracts values (as defined on the top of the file) for each of the lines which appear in the command output of "show ip ospf neighbor" (shared earlier), and records them in a dictionary/JSON object.</p>
<p>Please check the test case below, which runs and parses the "show ip ospf neighbor" output using above TextFSM template, and subsequently extracts the information based on the field names defined in the TextFSM template (i.e. NEIGHBOR_ID and NBR_STATE)</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nv">Check</span> <span class="nv">OSPF</span> <span class="nv">neighbour</span> <span class="nv">ID</span> <span class="nv">using</span> <span class="nv">TextFSM</span>
    <span class="nv">select</span> <span class="nv">device</span> <span class="s2">&quot;</span><span class="s">r1</span><span class="s2">&quot;</span>
    # <span class="nv">runs</span> <span class="nv">a</span> <span class="nv">command</span> <span class="nv">and</span> <span class="nv">parses</span> <span class="nv">it</span> <span class="nv">through</span> <span class="nv">the</span> <span class="nv">TextFSM</span> <span class="nv">template</span> <span class="nv">provided</span>
    # <span class="nv">cxta</span> <span class="nv">includes</span> <span class="nv">a</span> <span class="nv">large</span> <span class="nv">collection</span> <span class="nv">of</span> <span class="nv">templates</span> <span class="ss">(</span><span class="nv">view</span> <span class="nv">the</span> <span class="s1">&#39;</span><span class="s">Command Map</span><span class="s1">&#39;</span> <span class="nv">page</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">documentation</span><span class="ss">)</span>
    # <span class="nv">though</span> <span class="nv">you</span> <span class="nv">are</span> <span class="nv">able</span> <span class="nv">to</span> <span class="nv">specify</span> <span class="nv">your</span> <span class="nv">own</span> <span class="nv">template</span>, <span class="nv">as</span> <span class="nv">we</span> <span class="k">do</span> <span class="nv">in</span> <span class="nv">this</span> <span class="nv">example</span>
    <span class="nv">run</span> <span class="nv">parsed</span> <span class="s2">&quot;</span><span class="s">show ip ospf neighbor</span><span class="s2">&quot;</span> <span class="nv">with</span> <span class="nv">template</span> <span class="s2">&quot;</span><span class="s">${CURDIR}/show_ip_ospf_neighbor.textfsm</span><span class="s2">&quot;</span>
    # <span class="nv">get</span> <span class="nv">the</span> <span class="nv">data</span> <span class="nv">from</span> <span class="nv">the</span> <span class="nv">value</span> <span class="nv">of</span> <span class="s1">&#39;</span><span class="s">NEIGHBOR_ID</span><span class="s1">&#39;</span> <span class="nv">from</span> <span class="nv">the</span> <span class="nv">dictionary</span> <span class="nv">that</span> <span class="nv">was</span> <span class="nv">created</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">keyword</span> <span class="nv">above</span>
    ${<span class="nv">NBR_ID</span>}<span class="o">=</span>  <span class="nv">get</span> <span class="nv">parsed</span> <span class="s2">&quot;</span><span class="s">NEIGHBOR_ID</span><span class="s2">&quot;</span>
    # <span class="nv">the</span> <span class="nv">checks</span> <span class="nv">below</span> <span class="nv">assume</span> <span class="nv">that</span> <span class="nv">we</span> <span class="nv">only</span> <span class="nv">see</span> <span class="nv">a</span> <span class="nv">single</span> <span class="nv">neighbor</span>. <span class="k">If</span> <span class="nv">multiple</span> <span class="nv">neighbors</span>
    # <span class="nv">are</span> <span class="nv">found</span>, ${<span class="nv">NBR_ID</span>} <span class="nv">will</span> <span class="nv">be</span> <span class="nv">a</span> <span class="nv">list</span>, <span class="nv">and</span> <span class="nv">we</span> <span class="nv">would</span> <span class="nv">need</span> <span class="nv">to</span> <span class="nv">iterate</span> <span class="nv">through</span> <span class="nv">the</span> <span class="nv">list</span>, <span class="nv">we</span>
    # <span class="nv">leave</span> <span class="nv">this</span> <span class="nv">as</span> <span class="nv">an</span> <span class="nv">exercise</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">reader</span> <span class="c1">;-)</span>
    <span class="nv">Should</span> <span class="nv">be</span> <span class="nv">Equal</span> <span class="nv">as</span> <span class="nv">Strings</span>   ${<span class="nv">NBR_ID</span>}   <span class="mi">10</span>.<span class="mi">0</span>.<span class="mi">0</span>.<span class="mi">2</span>
    # <span class="nv">another</span> <span class="nv">example</span>, <span class="nv">this</span> <span class="nv">time</span> <span class="nv">getting</span> <span class="nv">the</span> <span class="nv">neighbor</span> <span class="nv">state</span>
    ${<span class="nv">NBR_STATE</span>}<span class="o">=</span>  <span class="nv">get</span> <span class="nv">parsed</span> <span class="s2">&quot;</span><span class="s">STATE</span><span class="s2">&quot;</span>
    <span class="nv">Should</span> <span class="nv">Contain</span>    ${<span class="nv">NBR_STATE</span>}   <span class="nv">FULL</span>
</pre></div>
</td></tr></table>

<p>Instead of using the <code>get parsed</code> keywords, you could also collect the return value from the <code>run parsed ...</code> keyword and examine the dictionary directly. We'll get back to parsing dict/json later.</p>
<h3 id="configuring-and-retrying">Configuring and Retrying</h3>
<p>The next test case also use TextFSM parsing, this time using one of CXTA's TextFSM templates (show cdp neighbor, you can view the template at /venv/lib/python3.6/site-packages/CXTA/core/commands/ios/show_cdp_neighbors.textfsm on the container).<br />
But to add a bit more "fun", we first configure CDP (Cisco Discovery Protocol, a simple protocol which allows you to discover [network] devices connected to a router), then re-run the command until a neighbour is seen (this can take up to a minute as CDP packets are not sent that frequently), before we parse it and check the host name of the neighbouring node. Finally we remove the CDP configuration to restore the test bed to its previous state (which is always a good practice):</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="o">***</span> <span class="nv">Variables</span> <span class="o">***</span>
${<span class="nv">CDP_CONFIG</span>}<span class="o">=</span>          <span class="nv">cdp</span> <span class="nv">run</span>\<span class="nv">ninterface</span> <span class="nv">GigabitEthernet2</span>\<span class="nv">ncdp</span> <span class="nv">enable</span>
${<span class="nv">REMOVE_CDP_CONFIG</span>}   <span class="nv">no</span> <span class="nv">cdp</span> <span class="nv">run</span>\<span class="nv">ninterface</span> <span class="nv">GigabitEthernet2</span>\<span class="nv">nno</span> <span class="nv">cdp</span> <span class="nv">enable</span>
[...]


<span class="nv">Enable</span> <span class="nv">CDP</span> <span class="nv">and</span> <span class="nv">check</span> <span class="nv">neighbor</span> <span class="nv">hostname</span> <span class="nv">using</span> <span class="nv">TextFSM</span>
    [<span class="nv">Setup</span>]   <span class="nv">configure</span> <span class="s2">&quot;</span><span class="s">${CDP_CONFIG}</span><span class="s2">&quot;</span> <span class="nv">on</span> <span class="nv">devices</span> <span class="s2">&quot;</span><span class="s">r1;r2</span><span class="s2">&quot;</span>
    <span class="nv">select</span> <span class="nv">device</span> <span class="s2">&quot;</span><span class="s">r1</span><span class="s2">&quot;</span>
    # <span class="nv">It</span> <span class="nv">takes</span> <span class="nv">a</span> <span class="nv">bit</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">CDP</span> <span class="nv">neighbor</span> <span class="nv">to</span> <span class="k">show</span>, <span class="nv">so</span> <span class="nv">we</span> <span class="nv">repeat</span> <span class="nv">a</span> <span class="nv">keyword</span> <span class="k">for</span> <span class="nv">a</span> <span class="nv">bit</span> <span class="nv">we</span> <span class="nv">see</span> <span class="nv">the</span> <span class="nv">relevant</span>
    # <span class="nv">info</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">output</span>
    <span class="nv">set</span> <span class="nv">monitor</span> <span class="nv">interval</span> <span class="nv">to</span> <span class="s2">&quot;</span><span class="s">15</span><span class="s2">&quot;</span> <span class="nv">seconds</span>
    <span class="nv">monitor</span> <span class="nv">command</span> <span class="s2">&quot;</span><span class="s">show cdp neighbors</span><span class="s2">&quot;</span> <span class="k">until</span> <span class="nv">output</span> <span class="nv">contains</span> <span class="s2">&quot;</span><span class="s">Total cdp entries displayed : 1</span><span class="s2">&quot;</span> <span class="nv">or</span> <span class="s2">&quot;</span><span class="s">60</span><span class="s2">&quot;</span> <span class="nv">seconds</span>

    # <span class="nv">now</span> <span class="nv">we</span> <span class="nv">have</span> <span class="nv">a</span> <span class="nv">cdp</span> <span class="nv">neighbor</span>, <span class="nv">we</span> <span class="nv">will</span> <span class="nv">run</span> <span class="nv">the</span> <span class="nv">neighbor</span> <span class="nv">table</span> <span class="nv">through</span> <span class="nv">the</span> <span class="nv">TextFSM</span> <span class="nv">parser</span>
    ${<span class="nv">output</span>}<span class="o">=</span>  <span class="nv">run</span> <span class="nv">parsed</span> <span class="s2">&quot;</span><span class="s">show cdp neighbors</span><span class="s2">&quot;</span>
    # <span class="nv">using</span> <span class="nv">the</span> <span class="nv">local</span> <span class="nv">interface</span>, <span class="nv">we</span> <span class="nv">can</span> <span class="nv">get</span> <span class="nv">the</span> <span class="nv">device</span> <span class="nv">id</span> <span class="ss">(</span><span class="nv">hostname</span><span class="ss">)</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">neighbor</span>
    ${<span class="nv">HOSTNAME</span>}<span class="o">=</span>  <span class="nv">get</span> <span class="nv">parsed</span> <span class="s2">&quot;</span><span class="s">device_id</span><span class="s2">&quot;</span> <span class="nv">where</span> <span class="s2">&quot;</span><span class="s">local_intf</span><span class="s2">&quot;</span> <span class="nv">is</span> <span class="s2">&quot;</span><span class="s">Gig 2</span><span class="s2">&quot;</span>
    <span class="nv">Should</span> <span class="nv">Start</span> <span class="nv">With</span>    ${<span class="nv">HOSTNAME</span>}   <span class="nv">r2</span>
    [<span class="nv">Teardown</span>]   <span class="nv">configure</span> <span class="s2">&quot;</span><span class="s">${REMOVE_CDP_CONFIG}</span><span class="s2">&quot;</span> <span class="nv">on</span> <span class="nv">devices</span> <span class="s2">&quot;</span><span class="s">r1;r2</span><span class="s2">&quot;</span>
</pre></div>
</td></tr></table>

<p>A few things to note here:</p>
<ul>
<li>
<p>You see that we put the configuration and the removal of CDP into test case <strong>Setup</strong> and <strong>Teardown</strong> functions (lines 8 and 20). You have already seen the <strong>Suite Setup</strong> which allows us to initialize the environment prior to the first test case executed, and the Test Setup function is equivalent within the test case context, i.e. we perform an initialization before the the first test keyword runs.<br />
Removing the configuration in the Teardown is especially important. This ensures that the configuration is removed, no matter if any prior test step failed or not.</p>
</li>
<li>
<p>We use the CXTA keyword <code>monitor command ...</code> to check the presence of a specific string. We could have also used a built-in Robot keyword <a href="http://robotframework.org/robotframework/latest/libraries/BuiltIn.html#Repeat%20Keyword">Repeat Keyword</a> to repeat the execution (left as a bonus exercise).</p>
</li>
<li>
<p>Finally, we use a different keyword, <code>get parsed ...</code> (#18) which again extracts values from the parsed output, but this time using an additional condition (especially practical if there was more than one neighbour).</p>
</li>
</ul>
<p>You can find the log.html of this test execution <a href="../logs/log-02-complex.html" target="_blank">here</a>.</p>
<h2 id="next-steps">Next Steps</h2>
<p>If you still have time, we would like to share a different, and even more powerful and versatile approach on how to parse Cisco and some other devices: <a href="../03-genie/">Parsing with pyATS GENIE</a></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../01-basic/" title="01 Basic Tests" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                01 Basic Tests
              </span>
            </div>
          </a>
        
        
          <a href="../03-genie/" title="03 pyATS Genie" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                03 pyATS Genie
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b806dc00.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>